# Лабораторная работа 6. Взаимодействие с базой данных. Авторизация и аутентификация

## Цель

Разработать веб-приложение для платформы проведения городских мероприятий, которое позволит гражданам узнавать и записываться на мероприятия.

## Условие

### Задание 1

Создайте базу данных `event_platform`.

### Задание 2

Создайте следующие таблицы в базе данных и корректно установите между ними отношения:

1. **Таблица `users`**:
   - Используется таблица с лабораторной работы №9.

2. **Таблица `events`**:
   - `id`: идентификатор мероприятия.
   - `name`: название мероприятия.
   - `price`: цена мероприятия.
   - `number_seats`: количество мест.
   - `date`: дата и время проведения.

3. **Таблица `event_records`**:
   - `id`: идентификатор записи.
   - `user_id`: идентификатор пользователя.
   - `event_id`: идентификатор мероприятия.

4. **Таблица `roles`**:
   - `id`: идентификатор роли.
   - `name`: название роли (например, `user`, `manager`).

### Задание 3

Внесите изменения в таблицу `users`, добавив поле `role_id`, содержащее идентификатор роли.

### Задание 4
Создайте следующие страницы:

1. Страница с текущими мероприятиями.
2. Страница для записи на определенное мероприятие.
3. Страница регистрации.
4. Страница авторизации.

### Задание 5

Разработайте административную панель (доступную только пользователю с ролью `manager`), с функционалом:

1. Добавление и изменение мероприятия.
2. Просмотр зарегистрированных пользователей на мероприятие.

### Задание 6

Сохраняйте все необходимые данные в базе данных.

## Дополнительные условия

### Задание 7 (1 уровень сложности)

Создайте более сложную схему ролей:

1. **Таблица `roles`**:
   - `id`: идентификатор роли.
   - `name`: название роли (например, `user`, `manager`).

2. **Таблица `capabilities`**:
   - `id`: идентификатор возможности.
   - `name`: название возможности (например, `can_view_panel`, `can_edit_event`).

3. **Таблица `roles_capabilities`**:
   - `id`: идентификатор связи.
   - `role_id`: идентификатор роли.
   - `capability_id`: идентификатор возможности.

С помощью данной схемы определите, какие возможности доступны каждой роли.

### Задание 8 (2 уровень сложности)

Реализуйте систему аутентификации на основе токенов. Для этого:

1. В таблицу `users` добавьте поле `token`, которое будет использоваться для хранения токенов пользователей.

2. Логика работы:
   - При входе пользователя сервер проверяет его учетные данные.
   - Если учетные данные верны, сервер создает уникальный токен доступа.
   - Клиент сохраняет токен в `localStorage` или cookies браузера для использования на протяжении сеанса.
   - При каждом запросе к защищенным ресурсам клиент передает токен в заголовке запроса.
   - Сервер проверяет токен, его валидность и права доступа пользователя.

## Отчет

1. Отчет по лабораторной работе должен соответствовать [Гиду по написанию отчетов по лабораторным работам](../lab_guidelines.md).
